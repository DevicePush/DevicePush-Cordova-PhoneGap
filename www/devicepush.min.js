var evt=document.createEvent("Event");evt.initEvent("deviceRegistered",!0,!0);var callbackNotificationReceived,_DP_currentPosition,_DP_urlApi="http://api.devicepush.com/mobile/";module.exports={register:function(e){if(window.localStorage.setItem("_DP_idUser",e.idUser),window.localStorage.setItem("_DP_idApplication",e.idApplication),"undefined"==typeof e.position||null===e.position||e.position===!1?window.localStorage.setItem("_DP_position",0):window.localStorage.setItem("_DP_position",1),"android"==device.platform||"Android"==device.platform)var t="Android";else var t="iOS";var o=new XMLHttpRequest;o.open("GET",_DP_urlApi+window.localStorage.getItem("_DP_idApplication")+"/senderid/",!0),o.setRequestHeader("token",window.localStorage.getItem("_DP_idUser")),o.setRequestHeader("Content-Type","application/json;charset=UTF-8"),o.onreadystatechange=function(){if(4==o.readyState&&200==o.status){var e=JSON.parse(o.responseText);window.localStorage.setItem("_DP_senderId",e.senderid);var i=PushNotification.init({android:{senderID:e.senderid},ios:{},wp:{}});"undefined"==typeof window.localStorage.getItem("_DP_devicePushToken")||null===window.localStorage.getItem("_DP_devicePushToken")?i.on("registration",function(e){window.localStorage.setItem("_DP_devicePushToken",e.registrationId);var o=new XMLHttpRequest;o.open("POST",_DP_urlApi+window.localStorage.getItem("_DP_idApplication")+"/",!0),o.setRequestHeader("token",window.localStorage.getItem("_DP_idUser")),o.setRequestHeader("Content-Type","application/json;charset=UTF-8"),o.onreadystatechange=function(){4==o.readyState&&200==o.status&&(window.localStorage.setItem("_DP_devicePushId",JSON.parse(o.responseText)._id),evt.devicePushId=window.localStorage.getItem("_DP_devicePushId"),evt.devicePushToken=window.localStorage.getItem("_DP_devicePushToken"),document.dispatchEvent(evt),1==window.localStorage.getItem("_DP_position")&&devicePush.getPosition())},o.send(JSON.stringify({token:e.registrationId,device:t}))}):1==window.localStorage.getItem("_DP_position")&&devicePush.getPosition(),i.on("notification",function(e){callbackNotificationReceived(e)}),i.on("error",function(e){alert("error -> "+e.message)})}},o.send()},getDeviceId:function(){return window.localStorage.getItem("_DP_devicePushId")},getDeviceToken:function(){return window.localStorage.getItem("_DP_devicePushToken")},notificationReceived:function(e){callbackNotificationReceived=e},setPosition:function(e){"undefined"==typeof e||null===e||e===!1?(window.localStorage.setItem("_DP_position",0),navigator.geolocation.clearWatch(_DP_currentPosition)):(window.localStorage.setItem("_DP_position",1),devicePush.getPosition())},getPosition:function(){_DP_currentPosition=navigator.geolocation.watchPosition(devicePush.putPosition,devicePush.errorPosition,{maximumAge:3e3,timeout:3e4,enableHighAccuracy:!0})},putPosition:function(e){var t=new XMLHttpRequest;t.open("POST",_DP_urlApi+"position/updateposition",!0),t.setRequestHeader("token",window.localStorage.getItem("_DP_idUser")),t.setRequestHeader("Content-Type","application/json;charset=UTF-8"),t.onreadystatechange=function(){4==t.readyState&&200==t.status},t.send(JSON.stringify({idDevice:window.localStorage.getItem("_DP_devicePushId"),lon:e.coords.longitude,lat:e.coords.latitude}))},errorPosition:function(){}};
//# sourceMappingURL=devicepush.min.js.map