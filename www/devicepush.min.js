var evtDR=document.createEvent("Event");evtDR.initEvent("deviceRegistered",!0,!0);var evtNR=document.createEvent("Event");evtNR.initEvent("notificationReceived",!0,!0);var _DP_currentPosition,_DP_Notifications=new Array,_DP_urlApi="http://api.devicepush.com/mobile/";module.exports={register:function(e){if(window.localStorage.setItem("_DP_idUser",e.idUser),window.localStorage.setItem("_DP_idApplication",e.idApplication),console.log("_DP_obj -> "+e),"undefined"==typeof e.position||null===e.position||e.position===!1?window.localStorage.setItem("_DP_position",0):window.localStorage.setItem("_DP_position",1),"android"==device.platform||"Android"==device.platform)var t="Android";else if("iOS"==device.platform)var t="iOS";else var t="Windows";devicePush.createStyle(t);var o=new XMLHttpRequest;o.open("GET",_DP_urlApi+window.localStorage.getItem("_DP_idApplication")+"/senderid/",!0),o.setRequestHeader("token",window.localStorage.getItem("_DP_idUser")),o.setRequestHeader("Content-Type","application/json;charset=UTF-8"),o.onreadystatechange=function(){if(4==o.readyState&&200==o.status){console.log("_DP_readyStateGET");var i=JSON.parse(o.responseText);window.localStorage.setItem("_DP_senderId",i.senderid);var n=PushNotification.init({android:{senderID:i.senderid},ios:{},windows:{}});"undefined"==typeof window.localStorage.getItem("_DP_devicePushToken")||null===window.localStorage.getItem("_DP_devicePushToken")?n.on("registration",function(o){console.log("_DP_registration"),window.localStorage.setItem("_DP_devicePushToken",o.registrationId);var i=new XMLHttpRequest;i.open("POST",_DP_urlApi+window.localStorage.getItem("_DP_idApplication")+"/",!0),i.setRequestHeader("token",window.localStorage.getItem("_DP_idUser")),i.setRequestHeader("Content-Type","application/json;charset=UTF-8"),i.onreadystatechange=function(){4==i.readyState&&200==i.status&&(console.log("readyStatePOST"),window.localStorage.setItem("_DP_devicePushId",JSON.parse(i.responseText)._id),evtDR.devicePushId=window.localStorage.getItem("_DP_devicePushId"),evtDR.devicePushToken=window.localStorage.getItem("_DP_devicePushToken"),document.dispatchEvent(evtDR),1==window.localStorage.getItem("_DP_position")&&devicePush.getPosition())},i.send(JSON.stringify({token:o.registrationId,device:t,additionaldata:e.additionalData}))}):1==window.localStorage.getItem("_DP_position")&&devicePush.getPosition(),n.on("notification",function(e){console.log(e),"undefined"==typeof e||null===e?console.log("_DP_data_error -> "+e):(evtNR.data=e,document.dispatchEvent(evtNR))}),n.on("error",function(e){console.log("_DP_error -> "+e.message)})}},o.send()},getDeviceId:function(){return window.localStorage.getItem("_DP_devicePushId")},getDeviceToken:function(){return window.localStorage.getItem("_DP_devicePushToken")},setPosition:function(e){console.log("_DP_setPosition -> "+e),"undefined"==typeof e||null===e||e===!1?(window.localStorage.setItem("_DP_position",0),navigator.geolocation.clearWatch(_DP_currentPosition)):(window.localStorage.setItem("_DP_position",1),devicePush.getPosition())},getPosition:function(){console.log("_DP_getPosition"),_DP_currentPosition=navigator.geolocation.watchPosition(devicePush.putPosition,devicePush.errorPosition,{maximumAge:3e3,timeout:3e4,enableHighAccuracy:!0})},putPosition:function(e){console.log("_DP_putPosition -> _DP_longitude"+e.coords.longitude+"_DP_latitude"+e.coords.latitude);var t=new XMLHttpRequest;t.open("POST",_DP_urlApi+"position/updateposition",!0),t.setRequestHeader("token",window.localStorage.getItem("_DP_idUser")),t.setRequestHeader("Content-Type","application/json;charset=UTF-8"),t.onreadystatechange=function(){4==t.readyState&&200==t.status},t.send(JSON.stringify({idDevice:window.localStorage.getItem("_DP_devicePushId"),lon:e.coords.longitude,lat:e.coords.latitude}))},errorPosition:function(e){console.log("_DP_errorPosition"+e)},putAdditionalData:function(e){console.log("_DP_putAdditionalData"),console.log(e);var t=new XMLHttpRequest;t.open("POST",_DP_urlApi+"additionaldata/updateadditionaldata",!0),t.setRequestHeader("token",window.localStorage.getItem("_DP_idUser")),t.setRequestHeader("Content-Type","application/json;charset=UTF-8"),t.onreadystatechange=function(){4==t.readyState&&200==t.status},t.send(JSON.stringify({idDevice:window.localStorage.getItem("_DP_devicePushId"),additionaldata:e.additionalData}))},createStyle:function(e){var t="",o=document.createElement("style");o.type="text/css","iOS"==e&&(t="padding-top:15px"),o.innerHTML+="._DP_notification{position: absolute;top: 0px;background-color: #333;color: #fff;width: 100%;height: auto;font-size: 11px;min-height: 30px;line-height: 30px;text-align: center;z-index: 99; "+t+"}._DP_containerCenter{-webkit-transform: translate3d(0, 0, 0);transform: translate3d(0, 0, 0)}._DP_containerTop{-webkit-transform: translate3d(0, -100%, 0);transform: translate3d(0, -100%, 0)}._DP_containerTransition {-webkit-transition-duration: .25s;transition-duration: .25s}",document.getElementsByTagName("head")[0].appendChild(o)},showNotification:function(e){var t=Date.now();document.body.innerHTML+='<div id="_DP_notification'+t+'" class="_DP_notification _DP_containerTop _DP_containerTransition">'+e+"</div>",_DP_Notifications[t]=setTimeout(function(){document.getElementById("_DP_notification"+t).classList.add("_DP_containerCenter"),document.getElementById("_DP_notification"+t).classList.remove("_DP_containerTop"),setTimeout(function(){document.getElementById("_DP_notification"+t).classList.add("_DP_containerTop"),document.getElementById("_DP_notification"+t).classList.remove("_DP_containerCenter"),setTimeout(function(){document.getElementById("_DP_notification"+t).remove(),clearInterval(_DP_Notifications[t]),delete _DP_Notifications[t]},250)},2e3)},100)}};
//# sourceMappingURL=devicepush.min.js.map