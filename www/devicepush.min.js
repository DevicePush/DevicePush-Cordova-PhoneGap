var evt=document.createEvent("Event");evt.initEvent("deviceRegistered",!0,!0);var callbackNotificationReceived,callbackError,_DP_currentPosition,_DP_urlApi="http://api.devicepush.com/mobile/";module.exports={register:function(e){if(window.localStorage.setItem("_DP_idUser",e.idUser),window.localStorage.setItem("_DP_idApplication",e.idApplication),console.log("_DP_obj -> "+e),"undefined"==typeof e.position||null===e.position||e.position===!1?window.localStorage.setItem("_DP_position",0):window.localStorage.setItem("_DP_position",1),"android"==device.platform||"Android"==device.platform)var t="Android";else if("iOS"==device.platform)var t="iOS";else var t="Windows";var o=new XMLHttpRequest;o.open("GET",_DP_urlApi+window.localStorage.getItem("_DP_idApplication")+"/senderid/",!0),o.setRequestHeader("token",window.localStorage.getItem("_DP_idUser")),o.setRequestHeader("Content-Type","application/json;charset=UTF-8"),o.onreadystatechange=function(){if(4==o.readyState&&200==o.status){console.log("_DP_readyStateGET");var i=JSON.parse(o.responseText);window.localStorage.setItem("_DP_senderId",i.senderid);var n=PushNotification.init({android:{senderID:i.senderid},ios:{},windows:{}});"undefined"==typeof window.localStorage.getItem("_DP_devicePushToken")||null===window.localStorage.getItem("_DP_devicePushToken")?n.on("registration",function(o){console.log("_DP_registration"),window.localStorage.setItem("_DP_devicePushToken",o.registrationId);var i=new XMLHttpRequest;i.open("POST",_DP_urlApi+window.localStorage.getItem("_DP_idApplication")+"/",!0),i.setRequestHeader("token",window.localStorage.getItem("_DP_idUser")),i.setRequestHeader("Content-Type","application/json;charset=UTF-8"),i.onreadystatechange=function(){4==i.readyState&&200==i.status&&(console.log("readyStatePOST"),window.localStorage.setItem("_DP_devicePushId",JSON.parse(i.responseText)._id),evt.devicePushId=window.localStorage.getItem("_DP_devicePushId"),evt.devicePushToken=window.localStorage.getItem("_DP_devicePushToken"),document.dispatchEvent(evt),1==window.localStorage.getItem("_DP_position")&&devicePush.getPosition())},i.send(JSON.stringify({token:o.registrationId,device:t,additionaldata:e.additionalData}))}):1==window.localStorage.getItem("_DP_position")&&devicePush.getPosition(),n.on("notification",function(e){"undefined"==typeof e||null===e?console.log("_DP_data_error -> "+e):callbackNotificationReceived(e)}),n.on("error",function(e){console.log("_DP_error -> "+e.message),callbackError(e.message)})}},o.send()},notificationReceived:function(e){callbackNotificationReceived=e},error:function(e){callbackError=e},getDeviceId:function(){return window.localStorage.getItem("_DP_devicePushId")},getDeviceToken:function(){return window.localStorage.getItem("_DP_devicePushToken")},setPosition:function(e){console.log("_DP_setPosition -> "+e),"undefined"==typeof e||null===e||e===!1?(window.localStorage.setItem("_DP_position",0),navigator.geolocation.clearWatch(_DP_currentPosition)):(window.localStorage.setItem("_DP_position",1),devicePush.getPosition())},getPosition:function(){console.log("_DP_getPosition"),_DP_currentPosition=navigator.geolocation.watchPosition(devicePush.putPosition,devicePush.errorPosition,{maximumAge:3e3,timeout:3e4,enableHighAccuracy:!0})},putPosition:function(e){console.log("_DP_putPosition"),console.log("_DP_longitude"+e.coords.longitude),console.log("_DP_latitude"+e.coords.latitude);var t=new XMLHttpRequest;t.open("POST",_DP_urlApi+"position/updateposition",!0),t.setRequestHeader("token",window.localStorage.getItem("_DP_idUser")),t.setRequestHeader("Content-Type","application/json;charset=UTF-8"),t.onreadystatechange=function(){4==t.readyState&&200==t.status},t.send(JSON.stringify({idDevice:window.localStorage.getItem("_DP_devicePushId"),lon:e.coords.longitude,lat:e.coords.latitude}))},errorPosition:function(){},putAdditionalData:function(e){console.log("_DP_putAdditionalData"),console.log(e);var t=new XMLHttpRequest;t.open("POST",_DP_urlApi+"additionaldata/updateadditionaldata",!0),t.setRequestHeader("token",window.localStorage.getItem("_DP_idUser")),t.setRequestHeader("Content-Type","application/json;charset=UTF-8"),t.onreadystatechange=function(){4==t.readyState&&200==t.status},t.send(JSON.stringify({idDevice:window.localStorage.getItem("_DP_devicePushId"),additionaldata:e.additionalData}))}};
//# sourceMappingURL=devicepush.min.js.map