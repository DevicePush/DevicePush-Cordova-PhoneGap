var pushNotification,idUser,idApplication,localPush,contentLocalPush,imageLocalPush,closeLocalPush,timeCreatePush,callbackNotificationReceived,xmlhttpPutPosition=new XMLHttpRequest,urlApi="http://api.devicepush.com/mobile/";module.exports={register:function(e){if(idUser=e.idUser,idApplication=e.idApplication,window.localStorage.setItem("idUser",e.idUser),window.localStorage.setItem("idApplication",e.idApplication),pushNotification=window.plugins.pushNotification,"Win32NT"==device.platform){var t=new XMLHttpRequest;t.open("GET",urlApi+e.idApplication+"/senderid/",!0),t.setRequestHeader("token",e.idUser),t.setRequestHeader("Content-Type","application/json;charset=UTF-8"),t.onreadystatechange=function(){if(4==t.readyState&&200==t.status){var e=JSON.parse(t.responseText);window.localStorage.setItem("channel",e.channel),pushNotification.register(devicePush.channelHandler,devicePush.errorHandler,{channelName:e.channel,ecb:"devicePush.onNotificationWP8",uccb:"devicePush.channelHandler",errcb:"devicePush.jsonErrorHandler"})}},t.send()}else if("android"==device.platform||"Android"==device.platform)if("undefined"==typeof window.localStorage.getItem("devicePushToken")||null===window.localStorage.getItem("devicePushToken")){var t=new XMLHttpRequest;t.open("GET",urlApi+e.idApplication+"/senderid/",!0),t.setRequestHeader("token",e.idUser),t.setRequestHeader("Content-Type","application/json;charset=UTF-8"),t.onreadystatechange=function(){if(4==t.readyState&&200==t.status){var e=JSON.parse(t.responseText);window.localStorage.setItem("senderId",e.senderid),pushNotification.register(devicePush.successRegisterAndroid,devicePush.errorRegister,{senderID:e.senderid,ecb:"devicePush.onNotificationGCM"})}},t.send()}else pushNotification.register(devicePush.successRegisterAndroid,devicePush.errorRegister,{senderID:window.localStorage.getItem("senderId"),ecb:"devicePush.onNotificationGCM"});else pushNotification.register(devicePush.successRegisterIOS,devicePush.errorRegister,{badge:"true",sound:"true",alert:"true",ecb:"devicePush.onNotificationAPN"})},getDeviceId:function(){return window.localStorage.getItem("devicePushId")},getDeviceToken:function(){return window.localStorage.getItem("devicePushToken")},create:function(){localPush||(localPush=document.createElement("div"),localPush.id="localPush",contentLocalPush=document.createElement("div"),contentLocalPush.id="contentLocalPush",contentLocalPush.className="contentLocalPush",localPush.appendChild(contentLocalPush),imageLocalPush=document.createElement("div"),imageLocalPush.id="imageLocalPush",imageLocalPush.className="imageLocalPush",localPush.appendChild(imageLocalPush),closeLocalPush=document.createElement("div"),closeLocalPush.id="closeLocalPush",closeLocalPush.className="closeLocalPush",localPush.appendChild(closeLocalPush),document.body.appendChild(localPush))},destroy:function(){document.body.removeChild(document.getElementById("localPush")),localPush=null},show:function(e){if(localPush){"top"===e.position||""===e.position?e.position="Top":"bottom"===e.position&&(e.position="Bottom");var t=timeCreatePush=(new Date).getTime();localPush.getElementsByClassName("contentLocalPush")[0].innerHTML=e.text,localPush.className="showPush"+e.position,e.image?(imageLocalPush.style.backgroundImage="url("+e.image+")",contentLocalPush.style.paddingLeft="50px"):(imageLocalPush.style.backgroundImage="",contentLocalPush.style.paddingLeft="20px"),e.time>0&&setTimeout(function(){timeCreatePush===t&&(localPush.className="hidePush"+e.position)},e.time),e.close?(closeLocalPush.className="closeLocalPush ion-close",contentLocalPush.style.paddingRight="50px",document.getElementById("closeLocalPush").addEventListener("touchend",function(){localPush.className="hidePush"+e.position})):(closeLocalPush.className="",contentLocalPush.style.paddingRight="20px")}},successRegisterAndroid:function(e){console.log("result = "+e)},successRegisterIOS:function(e){if("undefined"==typeof window.localStorage.getItem("devicePushToken")||null===window.localStorage.getItem("devicePushToken")){var t=new XMLHttpRequest;t.open("POST",urlApi+idApplication+"/",!0),t.setRequestHeader("token",idUser),t.setRequestHeader("Content-Type","application/json;charset=UTF-8"),t.onreadystatechange=function(){4==t.readyState&&200==t.status&&(window.localStorage.setItem("devicePushId",t.responseText),window.localStorage.setItem("devicePushToken",e),devicePush.getPosition())},t.send(JSON.stringify({token:e,device:"iOS"}))}else devicePush.getPosition()},errorRegister:function(e){console.log("error = "+e)},onNotificationGCM:function(e){switch(e.event){case"registered":if("undefined"==typeof window.localStorage.getItem("devicePushToken")||null===window.localStorage.getItem("devicePushToken")){if(e.regid.length>0){var t=new XMLHttpRequest;t.open("POST",urlApi+idApplication+"/",!0),t.setRequestHeader("token",idUser),t.setRequestHeader("Content-Type","application/json;charset=UTF-8"),t.onreadystatechange=function(){4==t.readyState&&200==t.status&&(window.localStorage.setItem("devicePushId",t.responseText),window.localStorage.setItem("devicePushToken",e.regid),devicePush.getPosition())},t.send(JSON.stringify({token:e.regid,device:"Android"}))}}else devicePush.getPosition();break;case"message":callbackNotificationReceived(e.payload.message);break;case"error":console.log("ERROR -> MSG:"+e.msg);break;default:console.log("EVENT -> Unknown, an event was received and we do not know what it is")}},onNotificationAPN:function(e){if(e.alert&&callbackNotificationReceived(e.alert),e.sound){var t=new Media(e.sound);t.play()}e.badge&&pushNotification.setApplicationIconBadgeNumber(successHandler,errorHandler,e.badge)},notificationReceived:function(e){callbackNotificationReceived=e},getPosition:function(){navigator.geolocation.watchPosition(devicePush.putPosition,devicePush.errorPosition,{maximumAge:3e3,timeout:5e3,enableHighAccuracy:!0})},putPosition:function(e){xmlhttpPutPosition.open("POST",urlApi+"position/updateposition",!0),xmlhttpPutPosition.setRequestHeader("token",window.localStorage.getItem("idUser")),xmlhttpPutPosition.setRequestHeader("Content-Type","application/json;charset=UTF-8"),xmlhttpPutPosition.onreadystatechange=function(){4==xmlhttpPutPosition.readyState&&200==xmlhttpPutPosition.status},xmlhttpPutPosition.send(JSON.stringify({idDevice:JSON.parse(window.localStorage.getItem("devicePushId")),lon:e.coords.longitude,lat:e.coords.latitude}))},errorPosition:function(){}};
//# sourceMappingURL=devicepush.min.js.map